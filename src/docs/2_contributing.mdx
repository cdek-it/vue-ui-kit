import { Meta } from '@storybook/blocks';

<Meta title="Contributing" />

# Contributing

### Создание issue

Первый шаг для внесения изменений - это [создание нового issue](https://gitlab.cdek.ru/FrontDev/cdek-vue-ui-kit/-/issues/new)
с корректными лейблами и подробным описанием того, что вы хотите сделать.

[Лейблы](https://gitlab.cdek.ru/FrontDev/cdek-vue-ui-kit/-/labels) разделяются на 2 большие группы - тип issue и место изменения. Типы можно посмотреть
по ссылке в Prioritized labels, там же есть описание каждого лейбла. Лейбл "типа" должен быть обязательно. Вторая группа - место изменения,
она обязательна, если это место уже существует. Есть синие метки под отдельные компоненты, розовые под стили, желтые под сервисы, оранжевые под плагины.
Если места изменения еще не существует, то лейбл "места" не ставим.

В поле `assignee` ставите себя, если сами планируете сделать это изменение, иначе оставьте пустым.

После создания issue, отправьте ссылку в канал [@cdek-ui-kit/vue](https://talk.cdek.ru/cdek/channels/cdek-ui-kitvue), либо лично
[@d.kirichkova](https://talk.cdek.ru/cdek/messages/@d.kirichkova).

### Issue попадает в milestone

Следующий шаг - это планирование в какой milestone попадет issue. [Milestones](https://gitlab.cdek.ru/FrontDev/cdek-vue-ui-kit/-/milestones) -
это срезы задач, запланированных на конкретную версию. По ссылке можно посмотреть текущую открытую версию и уже закрытые версии. Пока issue не привязан
к milestone - разработка **не может** быть в процессе.

### Создание ветки и MR

После всех предварительных обсуждений наконец-то можно создать ветку. Быстрый вариант это сделать напрямую через issue.

Зайдите на созданное issue и нажмите на стрелочку вниз справа от кнопки `Create merge request`. `Branch name` можно не менять, а вот в `Source`
надо указать ветку релиза. На каждый milestone есть релизная ветка названная по паттерну `release/<номер версии>`, например для milestone `0.4.0` будет
ветка `release/0.4.0`.

После того, как все укажете нажимаете кнопку `Create Merge Request` снизу в выпадающем окне и у вас автоматически создатся и ветка, и MR в релизную ветку.

### Локальная разработка

#### Подготовка репозитория

Для локальной разработки нужно скачать себе репозиторий `git clone git@gitlab.cdek.ru:FrontDev/cdek-vue-ui-kit.git`.

Рекомендуется использовать [VSCode](https://code.visualstudio.com/) или [Cursor](https://cursor.sh/).
В репозитории уже сохранена конфигурация для него, включая рекомендуемые плагины
и настройка авто форматтинга. Рекомендуемые плагины вы найдете в секции `recommended` в плагинах.

Проследите, чтобы пакет `Prettier ESLint` был установлен в версии `v5.1.0`, новая версия пока не поддерживается. Этот плагин заменяет стандартный
плагин `Prettier` - он вам не нужен. Этот пакет форматирует одновременно и по настройкам `Prettier` и по настройкам `ESLint`.

Проверьте, что в IDE все корректно настроено, если что обратитесь за помощью.

Установите зависимости через команду `yarn`.

Локальная разработка проводится в рамках `storybook`. Для запуска используйте команду `yarn storybook`.

#### Создание нового компонента

Для создания нового компонента используйте команду `yarn gen:component BaseName`. Вместо `Name` пропишите свой postfix. Этот скрипт автоматически
создаст готовую структуру в папке `components`

```
components
  | - base-name
        | - BaseName.vue          # файл самого компонента
        | - BaseName.stories.js   # истории
        | - BaseName.test.ts      # тесты
        | - index.ts              # экспорт всего, что нужно сделать импортируемым из либы
```

Также если вы делаете новый компонент, не забудьте добавить `import` в файле `main.ts` из папки. Иначе это не попадет в билд.

#### Требования

**Для новых компонентов**:

* ваш компонент должен быть универсален и учитывать разные ситуации
* вся функциональность должна быть корректно представлена в историях с правильными сниппетами кода
* компонент должен быть полностью покрыт unit-тестами
* компонент должен **экспортироваться** с префиксом `Cdek` (это уже зашито в генерацию)

**Для существующих компонентов**:

* новые изменения не должны ломать существующие тесты и должны быть покрыты новыми тестами
* существующие истории должны работать как и раньше, на новый функционал должны быть созданы доп. истории

#### StyleGuide

**Компонент**:

* Для скрипта `Typescript`, Composition API, `script setup`
* Для стилей `SCSS`, `scoped`, `module`, как префикс для стиля **всегда** используйте слово `prefix`
* Названия классов в `template` только через `$style`
* Предпочитаем необязательные пропсы, пропсы описываются многострочным комментарием (это попадет в секцию Docs в storybook как описание)
* По возможности предпочитаем слоты для контента, очень часто меняли props на slot, когда нужно что-то посерьезнее
* В стилях цвета, шрифты, медиа правила только с зарегистрированных SCSS переменных

**Истории**:

* В description обязательно вставляем ссылку на фигму
* Если видите, что во вкладке `Controls` неудобное управление пропсом, то адаптируем его в `argTypes`
  (например вместо строки сделать выпадающий список или для слота сделать строку)
* Для каждой истории добавляем сниппет в `Story.parameters.docs.source.code`, это необходимо чтобы в storybook конкретно отображался код истории

**Тесты**:

* Для маунта компонента с разными настройками используется паттерн [Builder](https://refactoring.guru/ru/design-patterns/builder)
* Был создан декоратор для упрощения создания параметров для этого паттерна `@builderProp`, используйте его

### Локальное тестирование

После того, как вы все закончили в storybook и там отрабатывает так, как это необходимо, вы можете протестировать новый функционал локально
в каком-нибудь проекте. Для этого запустите такие команды:

```bash dark
yarn build # создаст сборку
yarn link  # создаст локальную версию пакета
```

Далее в проекте, где используется ui-kit выполните команду `yarn link @cdek-ui-kit/vue`, это переведет ваш проект на локальную версию пакета.

Чтобы больше не ссылаться на вашу локальную версию, выполните команду `yarn unlink @cdek-ui-kit/vue`.

### Code Review

Отправьте ваш готовый MR в канал [FrontReview](https://talk.cdek.ru/cdek/channels/frontreview) и ждите ревью.

### Тестирование на alpha версии

Если на code review все было ок, то ваш код попадает в релизную ветку. На релизных ветках есть возможность собрать так называемую `alpha` версию.

Для этого измените в релизной ветке в `package.json` поле `version` по формату `<номер-версии>-alpha.<задача>`, например `0.4.0-alpha.mrkt1255` - это
альфа версия для релиза 0.4.0, созданная для задачи MRKT-1255.

После того, как вы вписали вашу версию, дождитесь выполнения pipeline на релизной ветке, последняя джоба мануальная `build` зарелизит вашу альфа версию.
Выпущенные версии можно посмотреть [здесь](https://gitlab.cdek.ru/FrontDev/cdek-vue-ui-kit/-/packages).

### Официальный релиз

Если все запланированные задачи в milestone закончены, и альфа версии не вызвали никаких багов, то выпускается официальный релиз.

Список всех релизов можно посмотреть [здесь](https://gitlab.cdek.ru/FrontDev/cdek-vue-ui-kit/-/releases). Там подробно описываются изменения с примерами
и прикладываются ссылки на новые истории. Только после релиза официальной версии перевыкладывается StoryBook по глобальной ссылке, там всегда висит
последний официальный релиз.

Официальный релиз довольно долго маринуется на альфа версиях, так что вам может быть невыгодно ждать его.
