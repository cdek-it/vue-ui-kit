import { Meta, Story } from '@storybook/blocks';
import * as BaseFormStories from '../BaseForm.stories.js';

<Meta title="Form/CdekForm/Validation" />

# Валидация

Поддерживая идею автономности формы, валидация происходит в фоне. Необходимо лишь передать информацию
в `CdekFormControl` о том, как будет валидироваться это поле, дальше форма делает все сама.

Функция-валидатор должна отдавать тип `true | string`, где `true` - это валидация прошла успешно,
`string` - это сообщение об ошибке, которое выведется на форме. На данный момент поддерживается только
валидация на лету, т.е. по мере изменений ошибка будет показываться сразу. Также при попытке `submit`
проводится дополнительная валидация, и если поле было не тронуто, то там покажется ошибка.

Предположим, поле обязательное, тогда валидатор может выглядеть так:

```js dark
(value) => {
  if (!value.trim()) {
    return 'Поле обязательное';
  }

  return true;
};
```

В элемент формы валидаторы нужно передавать в виде объекта `rules`:

```js dark
const rules = {
  required: (value) => {
    ...
  }
}
```

Где ключом в объекте будет выступать название валидатора, а значением функция с типом
`(value) => true | string`. Валидаторов можно передать несколько, они будут запускаться по очереди.

В `CdekFormControl` валидаторы передаются таким образом:

```html dark
<CdekFormControl name="firstName" :rules="rules" />
```

Здесь нам будут полезны 2 события на `CdekForm`:

```html dark
<CdekForm @submit="submit" @submitError="submitError"> ... </CdekForm>
```

Где `submit` сработает, только если валидация на всех полях пройдена. А в ином случае при попытке
`submit` сработает событие `submitError`.

`submitError` передаст в callback объект типа:

```js dark
{
  <название_поля>: true | <название_валидатора>
}
```

Где `true` будет означать, что валидация на этом поле прошла успешно, а строка (хранящая **название**
валидатора) - на каком валидаторе поле провалило проверку.

В целом `submitError` будет полезен только для дополнительного ввода ошибок, в базовом случае достаточно
дождаться пока сработает событие `submit` - это будет говорить о том, что валидация на всех полях прошла
успешно, и этот объект можно отправлять.

> Попробуйте нажать "Продолжить" при пустом `firstName`

> Попробуйте ввести значение в поле `firstName` и нажмите "Продолжить"

<Story of={BaseFormStories.WithValidation} />
